import{h as J,d as O,aD as X,i as G,J as K,aM as be,r as N,L as B,O as Y,R as Ce,b as s,aR as ie,p as ee,aP as U,al as re,l as ce,P as Pe,aE as Se,aN as Ie,Q as xe,Y as Q,aj as L,ak as _e,j as F,aT as ue,A,G as ae,z as $,aB as ke,ag as Re,V as M,aI as de,am as ze,C as Z,m as me,an as Te,ao as Fe,X as ve,y as Ve,a8 as fe,T as De,av as Ae,aU as $e,x as Be,a9 as Ue,B as Xe,c as Le,w as T,n as te,aS as Ye,aV as Me,o as Ne,e as W,t as q,a as Oe,f as Ee,_ as Ze}from"./index.ee12a00d.js";import{F as He,C as je,a as We}from"./index.1d2591d1.js";import{R as qe,a as Ge}from"./index.af0bd108.js";import{a as Je,S as Ke}from"./index.29d56ae3.js";import{T as oe}from"./function-call.e36ea00f.js";const ne=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),se=J("image-preview")[1];var Qe=O({props:{src:String,show:Boolean,active:Number,minZoom:X(G),maxZoom:X(G),rootWidth:X(Number),rootHeight:X(Number)},emits:["scale","close"],setup(e,{emit:l}){const a=K({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),r=be(),u=N(),w=B(()=>{const{rootWidth:t,rootHeight:c}=e,g=c/t;return a.imageRatio>g}),b=B(()=>{const{scale:t,moveX:c,moveY:g,moving:R,zooming:z}=a,V={transitionDuration:z||R?"0s":".3s"};if(t!==1){const pe=c/t,ye=g/t;V.transform=`scale(${t}, ${t}) translate(${pe}px, ${ye}px)`}return V}),P=B(()=>{if(a.imageRatio){const{rootWidth:t,rootHeight:c}=e,g=w.value?c/a.imageRatio:t;return Math.max(0,(a.scale*g-t)/2)}return 0}),i=B(()=>{if(a.imageRatio){const{rootWidth:t,rootHeight:c}=e,g=w.value?c:t*a.imageRatio;return Math.max(0,(a.scale*g-c)/2)}return 0}),n=t=>{t=U(t,+e.minZoom,+e.maxZoom+1),t!==a.scale&&(a.scale=t,l("scale",{scale:t,index:e.active}))},d=()=>{n(1),a.moveX=0,a.moveY=0},S=()=>{const t=a.scale>1?1:2;n(t),a.moveX=0,a.moveY=0};let v,I,x,_,m,p,k;const j=t=>{const{touches:c}=t,{offsetX:g}=r;r.start(t),v=c.length,I=a.moveX,x=a.moveY,k=Date.now(),a.moving=v===1&&a.scale!==1,a.zooming=v===2&&!g.value,a.zooming&&(_=a.scale,m=ne(t.touches))},o=t=>{const{touches:c}=t;if(r.move(t),(a.moving||a.zooming)&&ee(t,!0),a.moving){const{deltaX:g,deltaY:R}=r,z=g.value+I,V=R.value+x;a.moveX=U(z,-P.value,P.value),a.moveY=U(V,-i.value,i.value)}if(a.zooming&&c.length===2){const g=ne(c),R=_*g/m;n(R)}},f=()=>{if(v>1)return;const{offsetX:t,offsetY:c}=r,g=Date.now()-k,R=250,z=5;t.value<z&&c.value<z&&g<R&&(p?(clearTimeout(p),p=null,S()):p=setTimeout(()=>{l("close"),p=null},R))},C=t=>{let c=!1;(a.moving||a.zooming)&&(c=!0,a.moving&&I===a.moveX&&x===a.moveY&&(c=!1),t.touches.length||(a.zooming&&(a.moveX=U(a.moveX,-P.value,P.value),a.moveY=U(a.moveY,-i.value,i.value),a.zooming=!1),a.moving=!1,I=0,x=0,_=1,a.scale<1&&d(),a.scale>e.maxZoom&&(a.scale=+e.maxZoom))),ee(t,c),f(),r.reset()},y=t=>{const{naturalWidth:c,naturalHeight:g}=t.target;a.imageRatio=g/c};return Y(()=>e.active,d),Y(()=>e.show,t=>{t||d()}),Ce("touchmove",o,{target:B(()=>{var t;return(t=u.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>s(re,{type:"spinner"},null)};return s(Je,{ref:u,class:se("swipe-item"),onTouchstartPassive:j,onTouchend:C,onTouchcancel:C},{default:()=>[s(ie,{src:e.src,fit:"contain",class:se("image",{vertical:w.value}),style:b.value,onLoad:y},t)]})}}});const[ea,D]=J("image-preview"),aa=["show","transition","overlayStyle","closeOnPopstate"],ta={show:Boolean,loop:F,images:ue(),minZoom:A(1/3),maxZoom:A(3),overlay:F,closeable:Boolean,showIndex:F,className:ae,closeIcon:$("clear"),transition:String,beforeClose:Function,overlayClass:ae,overlayStyle:Object,swipeDuration:A(300),startPosition:A(0),showIndicators:Boolean,closeOnPopstate:F,closeIconPosition:$("top-right")};var ge=O({name:ea,props:ta,emits:["scale","close","closed","change","update:show"],setup(e,{emit:l,slots:a}){const r=N(),u=K({active:0,rootWidth:0,rootHeight:0}),w=()=>{if(r.value){const m=ke(r.value.$el);u.rootWidth=m.width,u.rootHeight=m.height,r.value.resize()}},b=m=>l("scale",m),P=m=>l("update:show",m),i=()=>{de(e.beforeClose,{args:[u.active],done:()=>P(!1)})},n=m=>{m!==u.active&&(u.active=m,l("change",m))},d=()=>{if(e.showIndex)return s("div",{class:D("index")},[a.index?a.index({index:u.active}):`${u.active+1} / ${e.images.length}`])},S=()=>{if(a.cover)return s("div",{class:D("cover")},[a.cover()])},v=()=>s(Ke,{ref:r,lazyRender:!0,loop:e.loop,class:D("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:n},{default:()=>[e.images.map(m=>s(Qe,{src:m,show:e.show,active:u.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:u.rootWidth,rootHeight:u.rootHeight,onScale:b,onClose:i},null))]}),I=()=>{if(e.closeable)return s(M,{role:"button",name:e.closeIcon,class:[D("close-icon",e.closeIconPosition),Re],onClick:i},null)},x=()=>l("closed"),_=(m,p)=>{var k;return(k=r.value)==null?void 0:k.swipeTo(m,p)};return ce({swipeTo:_}),Pe(w),Y([Se,Ie],w),Y(()=>e.startPosition,m=>n(+m)),Y(()=>e.show,m=>{const{images:p,startPosition:k}=e;m?(n(+k),xe(()=>{w(),_(+k,{immediate:!0})})):l("close",{index:u.active,url:p[u.active]})}),()=>s(_e,Q({class:[D(),e.className],overlayClass:[D("overlay"),e.overlayClass],onClosed:x,"onUpdate:show":P},L(e,aa)),{default:()=>[I(),v(),d(),S()]})}});let E;const oa={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function na(){({instance:E}=Te({setup(){const{state:e,toggle:l}=Fe(),a=()=>{e.images=[]};return()=>s(ge,Q(e,{onClosed:a,"onUpdate:show":l}),null)}}))}const H=(e,l=0)=>{if(!!ze)return E||na(),e=Array.isArray(e)?{images:e,startPosition:l}:e,E.open(Z({},oa,e)),E};H.Component=me(ge);H.install=e=>{e.use(H.Component)};const[sa,h,la]=J("uploader");function le(e,l){return new Promise(a=>{if(l==="file"){a();return}const r=new FileReader;r.onload=u=>{a(u.target.result)},l==="dataUrl"?r.readAsDataURL(e):l==="text"&&r.readAsText(e)})}function he(e,l){return ve(e).some(a=>a.file?Ve(l)?l(a.file):a.file.size>l:!1)}function ia(e,l){const a=[],r=[];return e.forEach(u=>{he(u,l)?r.push(u):a.push(u)}),{valid:a,invalid:r}}const ra=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i,ca=e=>ra.test(e);function we(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?ca(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var ua=O({props:{name:G,item:X(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:l,slots:a}){const r=()=>{const{status:n,message:d}=e.item;if(n==="uploading"||n==="failed"){const S=n==="failed"?s(M,{name:"close",class:h("mask-icon")},null):s(re,{class:h("loading")},null),v=De(d)&&d!=="";return s("div",{class:h("mask")},[S,v&&s("div",{class:h("mask-message")},[d])])}},u=n=>{const{name:d,item:S,index:v,beforeDelete:I}=e;n.stopPropagation(),de(I,{args:[S,{name:d,index:v}],done:()=>l("delete")})},w=()=>l("preview"),b=()=>{if(e.deletable&&e.item.status!=="uploading"){const n=a["preview-delete"];return s("div",{role:"button",class:h("preview-delete",{shadow:!n}),tabindex:0,"aria-label":la("delete"),onClick:u},[n?n():s(M,{name:"cross",class:h("preview-delete-icon")},null)])}},P=()=>{if(a["preview-cover"]){const{index:n,item:d}=e;return s("div",{class:h("preview-cover")},[a["preview-cover"](Z({index:n},d))])}},i=()=>{const{item:n,lazyLoad:d,imageFit:S,previewSize:v}=e;return we(n)?s(ie,{fit:S,src:n.content||n.url,class:h("preview-image"),width:Array.isArray(v)?v[0]:v,height:Array.isArray(v)?v[1]:v,lazyLoad:d,onClick:w},{default:P}):s("div",{class:h("file"),style:fe(e.previewSize)},[s(M,{class:h("file-icon"),name:"description"},null),s("div",{class:[h("file-name"),"van-ellipsis"]},[n.file?n.file.name:n.url]),P()])};return()=>s("div",{class:h("preview")},[i(),r(),b()])}});const da={name:A(""),accept:$("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:A(1/0),imageFit:$("cover"),resultType:$("dataUrl"),uploadIcon:$("photograph"),uploadText:String,deletable:F,afterRead:Function,showUpload:F,modelValue:ue(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:F,previewOptions:Object,previewFullImage:F,maxSize:{type:[Number,String,Function],default:1/0}};var ma=O({name:sa,props:da,emits:["delete","oversize","click-upload","close-preview","click-preview","update:modelValue"],setup(e,{emit:l,slots:a}){const r=N(),u=[],w=(o=e.modelValue.length)=>({name:e.name,index:o}),b=()=>{r.value&&(r.value.value="")},P=o=>{if(b(),he(o,e.maxSize))if(Array.isArray(o)){const f=ia(o,e.maxSize);if(o=f.valid,l("oversize",f.invalid,w()),!o.length)return}else{l("oversize",o,w());return}o=K(o),l("update:modelValue",[...e.modelValue,...ve(o)]),e.afterRead&&e.afterRead(o,w())},i=o=>{const{maxCount:f,modelValue:C,resultType:y}=e;if(Array.isArray(o)){const t=+f-C.length;o.length>t&&(o=o.slice(0,t)),Promise.all(o.map(c=>le(c,y))).then(c=>{const g=o.map((R,z)=>{const V={file:R,status:"",message:""};return c[z]&&(V.content=c[z]),V});P(g)})}else le(o,y).then(t=>{const c={file:o,status:"",message:""};t&&(c.content=t),P(c)})},n=o=>{const{files:f}=o.target;if(e.disabled||!f||!f.length)return;const C=f.length===1?f[0]:[].slice.call(f);if(e.beforeRead){const y=e.beforeRead(C,w());if(!y){b();return}if(Be(y)){y.then(t=>{i(t||C)}).catch(b);return}}i(C)};let d;const S=()=>l("close-preview"),v=o=>{if(e.previewFullImage){const f=e.modelValue.filter(we),C=f.map(y=>(y.file&&!y.url&&y.status!=="failed"&&(y.url=URL.createObjectURL(y.file),u.push(y.url)),y.url)).filter(Boolean);d=H(Z({images:C,startPosition:f.indexOf(o),onClose:S},e.previewOptions))}},I=()=>{d&&d.close()},x=(o,f)=>{const C=e.modelValue.slice(0);C.splice(f,1),l("update:modelValue",C),l("delete",o,w(f))},_=(o,f)=>{const C=["imageFit","deletable","previewSize","beforeDelete"],y=Z(L(e,C),L(o,C,!0));return s(ua,Q({item:o,index:f,onClick:()=>l("click-preview",o,w(f)),onDelete:()=>x(o,f),onPreview:()=>v(o)},L(e,["name","lazyLoad"]),y),L(a,["preview-cover","preview-delete"]))},m=()=>{if(e.previewImage)return e.modelValue.map(_)},p=o=>l("click-upload",o),k=()=>{if(e.modelValue.length>=e.maxCount||!e.showUpload)return;const o=e.readonly?null:s("input",{ref:r,type:"file",class:h("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:n},null);return a.default?s("div",{class:h("input-wrapper"),onClick:p},[a.default(),o]):s("div",{class:h("upload",{readonly:e.readonly}),style:fe(e.previewSize),onClick:p},[s(M,{name:e.uploadIcon,class:h("upload-icon")},null),e.uploadText&&s("span",{class:h("upload-text")},[e.uploadText]),o])},j=()=>{r.value&&!e.disabled&&r.value.click()};return Ae(()=>{u.forEach(o=>URL.revokeObjectURL(o))}),ce({chooseFile:j,closeImagePreview:I}),$e(()=>e.modelValue),()=>s("div",{class:h()},[s("div",{class:h("wrapper",{disabled:e.disabled})},[m(),k()])])}});const va=me(ma);const fa=O({__name:"execute",setup(e){const l=N(!1),a=Ue(),r=Ee(),w=Ye().query.id,b=N({status:"",images:[],remark:""});async function P(i){const n=new FormData;n.append("status",i.status),i.remark&&n.append("remark",i.remark),i.images.length>0&&i.images.forEach(S=>{n.append("images",S.file)}),l.value=!0;const d=await Me(w,n);l.value=!1,d.success?(oe.success(a.translate("operateSuccess")),r.go(-1)):oe.fail(d.msg)}return(i,n)=>{const d=qe,S=Ge,v=He,I=va,x=je,_=Xe,m=We;return Ne(),Le("div",{class:te(i.$style.page)},[s(m,{onSubmit:P},{default:T(()=>[s(x,null,{default:T(()=>[s(v,{label:i.$translate("result"),name:"status",required:"",rules:[{required:!0,message:i.$translate("please.select.result")}]},{input:T(()=>[s(S,{modelValue:b.value.status,"onUpdate:modelValue":n[0]||(n[0]=p=>b.value.status=p),direction:"horizontal"},{default:T(()=>[s(d,{name:"success"},{default:T(()=>[W(q(i.$translate("completed")),1)]),_:1}),s(d,{name:"fail"},{default:T(()=>[W(q(i.$translate("fail")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),s(v,{label:i.$translate("image"),name:"images"},{input:T(()=>[s(I,{accept:"image/png,image/jpeg,image/jpg",modelValue:b.value.images,"onUpdate:modelValue":n[1]||(n[1]=p=>b.value.images=p),"max-count":3},null,8,["modelValue"])]),_:1},8,["label"]),s(v,{label:i.$translate("remark"),type:"textarea",name:"remark",modelValue:b.value.remark,"onUpdate:modelValue":n[2]||(n[2]=p=>b.value.remark=p),placeholder:i.$translate("input.remark"),maxlength:"200","show-word-limit":""},null,8,["label","modelValue","placeholder"])]),_:1}),Oe("div",{class:te(i.$style.button)},[s(_,{block:"",type:"primary","native-type":"submit",loading:l.value},{default:T(()=>[W(q(i.$translate("confirm")),1)]),_:1},8,["loading"])],2)]),_:1})],2)}}}),ga="_page_7rvoe_1",ha="_button_7rvoe_7",wa={page:ga,button:ha},pa={$style:wa},Ia=Ze(fa,[["__cssModules",pa]]);export{Ia as default};
